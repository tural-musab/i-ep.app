{"version":3,"sources":["/Users/turanmusabosman/Projects/i-ep.app/src/lib/audit/index.ts"],"sourcesContent":["/**\n * Audit/Denetim loglama modülü\n *\n * Bu modül, sistemdeki işlemlerin denetim kayıtlarını yönetir ve\n * erişim reddi loglarına erişim sağlar.\n */\n\nimport { logAccessDenied, getAccessDeniedLogs } from '../tenant/tenant-access';\n\n/**\n * Sistem işlemlerini logla (INSERT, UPDATE, DELETE)\n *\n * Not: Bu işlemler veritabanı seviyesinde otomatik olarak\n * audit.log_activity tetikleyicisi ile yapılmaktadır\n */\n\n// Tenant access modülünden export edilen fonksiyonları yeniden export et\nexport { logAccessDenied, getAccessDeniedLogs };\n\n/**\n * Özel uygulamaların denetim logu\n *\n * @param tenantId İlgili tenant ID'si\n * @param userId İşlemi yapan kullanıcı ID'si\n * @param action Yapılan işlem\n * @param entityType İşlem yapılan varlık türü\n * @param entityId İşlem yapılan varlık ID'si\n * @param metadata Ek bilgiler\n */\nexport async function logAuditEvent(\n  tenantId: string,\n  userId: string,\n  action: string,\n  entityType: string,\n  entityId: string,\n  oldData?: Record<string, any>,\n  newData?: Record<string, any>,\n  metadata?: Record<string, any>\n): Promise<void> {\n  try {\n    // Erişim reddi loglama fonksiyonunun altyapısını kullan\n    await logAccessDenied(\n      userId,\n      tenantId,\n      entityType, // Şema adı yerine entityType kullanıyoruz\n      'audit_logs', // Tablo adı sabit\n      action,\n      'manual_audit_log', // Neden\n      {\n        old_data: oldData || null,\n        new_data: newData || null,\n        entity_id: entityId,\n        metadata: metadata || {},\n      }\n    );\n  } catch (error) {\n    console.error('Audit log kayıt hatası:', error);\n  }\n}\n"],"names":["getAccessDeniedLogs","logAccessDenied","logAuditEvent","tenantId","userId","action","entityType","entityId","oldData","newData","metadata","old_data","new_data","entity_id","error","console"],"mappings":"AAAA;;;;;CAKC;;;;;;;;;;;IAYyBA,mBAAmB;eAAnBA,iCAAmB;;IAApCC,eAAe;eAAfA,6BAAe;;IAYFC,aAAa;eAAbA;;;8BAtB+B;AAsB9C,eAAeA,cACpBC,QAAgB,EAChBC,MAAc,EACdC,MAAc,EACdC,UAAkB,EAClBC,QAAgB,EAChBC,OAA6B,EAC7BC,OAA6B,EAC7BC,QAA8B;IAE9B,IAAI;QACF,wDAAwD;QACxD,MAAMT,IAAAA,6BAAe,EACnBG,QACAD,UACAG,YACA,cACAD,QACA,oBACA;YACEM,UAAUH,WAAW;YACrBI,UAAUH,WAAW;YACrBI,WAAWN;YACXG,UAAUA,YAAY,CAAC;QACzB;IAEJ,EAAE,OAAOI,OAAO;QACdC,QAAQD,KAAK,CAAC,2BAA2BA;IAC3C;AACF"}